{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.refCount = void 0;\n\nvar lift_1 = require(\"../util/lift\");\n\nvar OperatorSubscriber_1 = require(\"./OperatorSubscriber\");\n\nfunction refCount() {\n  return lift_1.operate(function (source, subscriber) {\n    var connection = null;\n    source._refCount++;\n    var refCounter = new OperatorSubscriber_1.OperatorSubscriber(subscriber, undefined, undefined, undefined, function () {\n      if (!source || source._refCount <= 0 || 0 < --source._refCount) {\n        connection = null;\n        return;\n      }\n\n      var sharedConnection = source._connection;\n      var conn = connection;\n      connection = null;\n\n      if (sharedConnection && (!conn || sharedConnection === conn)) {\n        sharedConnection.unsubscribe();\n      }\n\n      subscriber.unsubscribe();\n    });\n    source.subscribe(refCounter);\n\n    if (!refCounter.closed) {\n      connection = source.connect();\n    }\n  });\n}\n\nexports.refCount = refCount;","map":{"version":3,"sources":["../../../../src/internal/operators/refCount.ts"],"names":[],"mappings":";;;;;;;AAGA,IAAA,MAAA,GAAA,OAAA,CAAA,cAAA,CAAA;;AACA,IAAA,oBAAA,GAAA,OAAA,CAAA,sBAAA,CAAA;;AA6DA,SAAgB,QAAhB,GAAwB;AACtB,SAAO,MAAA,CAAA,OAAA,CAAQ,UAAC,MAAD,EAAS,UAAT,EAAmB;AAChC,QAAI,UAAU,GAAwB,IAAtC;AAEC,IAAA,MAAc,CAAC,SAAf;AAED,QAAM,UAAU,GAAG,IAAI,oBAAA,CAAA,kBAAJ,CAAuB,UAAvB,EAAmC,SAAnC,EAA8C,SAA9C,EAAyD,SAAzD,EAAoE,YAAA;AACrF,UAAI,CAAC,MAAD,IAAY,MAAc,CAAC,SAAf,IAA4B,CAAxC,IAA6C,IAAI,EAAG,MAAc,CAAC,SAAvE,EAAkF;AAChF,QAAA,UAAU,GAAG,IAAb;AACA;AACD;;AA2BD,UAAM,gBAAgB,GAAI,MAAc,CAAC,WAAzC;AACA,UAAM,IAAI,GAAG,UAAb;AACA,MAAA,UAAU,GAAG,IAAb;;AAEA,UAAI,gBAAgB,KAAK,CAAC,IAAD,IAAS,gBAAgB,KAAK,IAAnC,CAApB,EAA8D;AAC5D,QAAA,gBAAgB,CAAC,WAAjB;AACD;;AAED,MAAA,UAAU,CAAC,WAAX;AACD,KAxCkB,CAAnB;AA0CA,IAAA,MAAM,CAAC,SAAP,CAAiB,UAAjB;;AAEA,QAAI,CAAC,UAAU,CAAC,MAAhB,EAAwB;AACtB,MAAA,UAAU,GAAI,MAAmC,CAAC,OAApC,EAAd;AACD;AACF,GApDM,CAAP;AAqDD;;AAtDD,OAAA,CAAA,QAAA,GAAA,QAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.refCount = void 0;\nvar lift_1 = require(\"../util/lift\");\nvar OperatorSubscriber_1 = require(\"./OperatorSubscriber\");\nfunction refCount() {\n    return lift_1.operate(function (source, subscriber) {\n        var connection = null;\n        source._refCount++;\n        var refCounter = new OperatorSubscriber_1.OperatorSubscriber(subscriber, undefined, undefined, undefined, function () {\n            if (!source || source._refCount <= 0 || 0 < --source._refCount) {\n                connection = null;\n                return;\n            }\n            var sharedConnection = source._connection;\n            var conn = connection;\n            connection = null;\n            if (sharedConnection && (!conn || sharedConnection === conn)) {\n                sharedConnection.unsubscribe();\n            }\n            subscriber.unsubscribe();\n        });\n        source.subscribe(refCounter);\n        if (!refCounter.closed) {\n            connection = source.connect();\n        }\n    });\n}\nexports.refCount = refCount;\n//# sourceMappingURL=refCount.js.map"]},"metadata":{},"sourceType":"script"}