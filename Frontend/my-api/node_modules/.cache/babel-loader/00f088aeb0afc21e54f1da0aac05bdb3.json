{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.timeout = exports.TimeoutError = void 0;\n\nvar async_1 = require(\"../scheduler/async\");\n\nvar isDate_1 = require(\"../util/isDate\");\n\nvar lift_1 = require(\"../util/lift\");\n\nvar innerFrom_1 = require(\"../observable/innerFrom\");\n\nvar createErrorClass_1 = require(\"../util/createErrorClass\");\n\nvar OperatorSubscriber_1 = require(\"./OperatorSubscriber\");\n\nvar executeSchedule_1 = require(\"../util/executeSchedule\");\n\nexports.TimeoutError = createErrorClass_1.createErrorClass(function (_super) {\n  return function TimeoutErrorImpl(info) {\n    if (info === void 0) {\n      info = null;\n    }\n\n    _super(this);\n\n    this.message = 'Timeout has occurred';\n    this.name = 'TimeoutError';\n    this.info = info;\n  };\n});\n\nfunction timeout(config, schedulerArg) {\n  var _a = isDate_1.isValidDate(config) ? {\n    first: config\n  } : typeof config === 'number' ? {\n    each: config\n  } : config,\n      first = _a.first,\n      each = _a.each,\n      _b = _a.with,\n      _with = _b === void 0 ? timeoutErrorFactory : _b,\n      _c = _a.scheduler,\n      scheduler = _c === void 0 ? schedulerArg !== null && schedulerArg !== void 0 ? schedulerArg : async_1.asyncScheduler : _c,\n      _d = _a.meta,\n      meta = _d === void 0 ? null : _d;\n\n  if (first == null && each == null) {\n    throw new TypeError('No timeout provided.');\n  }\n\n  return lift_1.operate(function (source, subscriber) {\n    var originalSourceSubscription;\n    var timerSubscription;\n    var lastValue = null;\n    var seen = 0;\n\n    var startTimer = function (delay) {\n      timerSubscription = executeSchedule_1.executeSchedule(subscriber, scheduler, function () {\n        try {\n          originalSourceSubscription.unsubscribe();\n          innerFrom_1.innerFrom(_with({\n            meta: meta,\n            lastValue: lastValue,\n            seen: seen\n          })).subscribe(subscriber);\n        } catch (err) {\n          subscriber.error(err);\n        }\n      }, delay);\n    };\n\n    originalSourceSubscription = source.subscribe(new OperatorSubscriber_1.OperatorSubscriber(subscriber, function (value) {\n      timerSubscription === null || timerSubscription === void 0 ? void 0 : timerSubscription.unsubscribe();\n      seen++;\n      subscriber.next(lastValue = value);\n      each > 0 && startTimer(each);\n    }, undefined, undefined, function () {\n      if (!(timerSubscription === null || timerSubscription === void 0 ? void 0 : timerSubscription.closed)) {\n        timerSubscription === null || timerSubscription === void 0 ? void 0 : timerSubscription.unsubscribe();\n      }\n\n      lastValue = null;\n    }));\n    startTimer(first != null ? typeof first === 'number' ? first : +first - scheduler.now() : each);\n  });\n}\n\nexports.timeout = timeout;\n\nfunction timeoutErrorFactory(info) {\n  throw new exports.TimeoutError(info);\n}","map":{"version":3,"sources":["../../../../src/internal/operators/timeout.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.timeout = exports.TimeoutError = void 0;\nvar async_1 = require(\"../scheduler/async\");\nvar isDate_1 = require(\"../util/isDate\");\nvar lift_1 = require(\"../util/lift\");\nvar innerFrom_1 = require(\"../observable/innerFrom\");\nvar createErrorClass_1 = require(\"../util/createErrorClass\");\nvar OperatorSubscriber_1 = require(\"./OperatorSubscriber\");\nvar executeSchedule_1 = require(\"../util/executeSchedule\");\nexports.TimeoutError = createErrorClass_1.createErrorClass(function (_super) {\n    return function TimeoutErrorImpl(info) {\n        if (info === void 0) { info = null; }\n        _super(this);\n        this.message = 'Timeout has occurred';\n        this.name = 'TimeoutError';\n        this.info = info;\n    };\n});\nfunction timeout(config, schedulerArg) {\n    var _a = (isDate_1.isValidDate(config)\n        ? { first: config }\n        : typeof config === 'number'\n            ? { each: config }\n            : config), first = _a.first, each = _a.each, _b = _a.with, _with = _b === void 0 ? timeoutErrorFactory : _b, _c = _a.scheduler, scheduler = _c === void 0 ? schedulerArg !== null && schedulerArg !== void 0 ? schedulerArg : async_1.asyncScheduler : _c, _d = _a.meta, meta = _d === void 0 ? null : _d;\n    if (first == null && each == null) {\n        throw new TypeError('No timeout provided.');\n    }\n    return lift_1.operate(function (source, subscriber) {\n        var originalSourceSubscription;\n        var timerSubscription;\n        var lastValue = null;\n        var seen = 0;\n        var startTimer = function (delay) {\n            timerSubscription = executeSchedule_1.executeSchedule(subscriber, scheduler, function () {\n                try {\n                    originalSourceSubscription.unsubscribe();\n                    innerFrom_1.innerFrom(_with({\n                        meta: meta,\n                        lastValue: lastValue,\n                        seen: seen,\n                    })).subscribe(subscriber);\n                }\n                catch (err) {\n                    subscriber.error(err);\n                }\n            }, delay);\n        };\n        originalSourceSubscription = source.subscribe(new OperatorSubscriber_1.OperatorSubscriber(subscriber, function (value) {\n            timerSubscription === null || timerSubscription === void 0 ? void 0 : timerSubscription.unsubscribe();\n            seen++;\n            subscriber.next((lastValue = value));\n            each > 0 && startTimer(each);\n        }, undefined, undefined, function () {\n            if (!(timerSubscription === null || timerSubscription === void 0 ? void 0 : timerSubscription.closed)) {\n                timerSubscription === null || timerSubscription === void 0 ? void 0 : timerSubscription.unsubscribe();\n            }\n            lastValue = null;\n        }));\n        startTimer(first != null ? (typeof first === 'number' ? first : +first - scheduler.now()) : each);\n    });\n}\nexports.timeout = timeout;\nfunction timeoutErrorFactory(info) {\n    throw new exports.TimeoutError(info);\n}\n//# sourceMappingURL=timeout.js.map"]},"metadata":{},"sourceType":"script"}